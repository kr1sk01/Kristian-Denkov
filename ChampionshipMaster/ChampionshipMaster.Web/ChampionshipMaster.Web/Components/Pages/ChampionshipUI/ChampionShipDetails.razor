@page "/championshipDetails"
@using Microsoft.AspNetCore.WebUtilities
@inject IHttpClientFactory httpClient
@inject NavigationManager nManager
@inject IConfiguration configuration
<PageTitle>Championship Info</PageTitle>

@if (championshipWithDetails != null)
{
    <div class="container">
        @foreach (var game in championshipWithDetails.Games)
        {
            <div class="box">
                <center><p>Game name: @game.Name</p></center>
                <p>Game Type: @game.GameTypeName</p>
                <p>Blue Team: @game.BlueTeamName</p>
                <p>Red name: @game.RedTeamName</p>
            </div>

            <div class="box">
                <center><p>Game name: @game.Name</p></center>
                <p>Game Type: @game.GameTypeName</p>
                <p>Blue Team: @game.BlueTeamName</p>
                <p>Red name: @game.RedTeamName</p>
            </div>
        }
    </div>

}

@code {
    public string? id;

    private string? data;

    protected override void OnInitialized()
    {

        // Get the query parameters from the URL
        var uri = nManager.ToAbsoluteUri(nManager.Uri);
        var queryParams = QueryHelpers.ParseQuery(uri.Query);

        // Extract the data parameter from the query parameters
        if (queryParams.TryGetValue("id", out var data))
        {
                id = Uri.UnescapeDataString(data);
        }
    }

    private ChampionshipDto? championshipWithDetails;

    protected override async Task OnInitializedAsync()
    {
        using HttpClient client = httpClient.CreateClient(configuration["ClientName"]!);
        var test = await client.GetFromJsonAsync<ChampionshipDto>($"api/Championship/{id}");
        if (test != null)
            championshipWithDetails = test;
    }
}
